# 应用程序开发流程
更新日期：2020/6/25

## 流程简介
在xbook2中，应用程序即用户态进程，既可以是普通的应用，也可以是服务进程。普通应用一般需要在shell程序中启动。而服务进程则根据服务类型来确定。

### 1.搭建应用程序项目
在user目录下面复制template这个模板，可以方便开发。复制后，修改成自己应用程序的名字。例如：hello。  
然后查看**user/README.md**文件，可以发现一些已经使用的程序占用磁盘的扇区起始位置，扇区数等信息，这些信息只是辅助你管理磁盘，系统并不会根据这里面的内容设置磁盘信息。  
一般都是需要添加在后面磁盘应用程序占用信息记录。例如：hello占用的磁盘起始位置是**5400**，扇区数是**100**，也就是50kb的内容。  
接下来，就是真正把数据写入到磁盘中，在**hello/Makefile**中可以找到
**BIN_OFF**这个变量，它的值就是要写入的磁盘起始位置，而**BIN_CNTS**就是对应的占用的扇区数。  
现在，这个项目就搭建好了。

### 2.编译流程
打开**hello/cmd.bat**或者是在hello中打开终端都可以，然后输入**make**，就可以编译程序了，与此同时，也将生成的可执行文件写入到磁盘中了。输入**make clean**清除编译过程中产生的.o文件和.out文件。

### 3.在文件系统服务进程中注册这个文件的信息
打开**service/filesrv**这个服务进程，进入**core/init.c**初始化里面，找到**file_map_table**这个数组，添加一个{"c:/hello", 100 * 512, 5400, 0, NULL}，第一个成员表示在文件系统中的路径，第二个表示文件的大小，第三个表示文件在磁盘上的绝对偏移，第4个表示是否在文件系统服务中启动，1表示是，0表示不是。由于是应用程序，需要在shell中启动，所以设置为0,最后一个参数是启动时的参数（一般应用程序不需要指定，设置为**NULL**就行）  
注册完信息后，需要编译一下文件系统服务，才能生效。于是打开**filesrv/cmd.bat**，输入**make**即可编译。

### 4.启动流程
在文件系统服务进程执行过程中，将文件映射表中的文件写入文件系统，也就完成了文件的写入。  
在shell中输入hello即可执行。
